{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block meta %}
    <meta property="og:title" content="{{ post.title }}">
    {% if post.excerpt %}
        <meta name="description" content="{{ post.excerpt|striptags }}">
    {% endif %}
    {% set tagNames = [] %}
    {% for tag in post.tags %}
        {% set tagNames = tagNames|merge([tag.name]) %}
    {% endfor %}
    <meta name="keywords" content="{{ tagNames|join(', ') }}">
    <link rel="canonical" href="{{ absolute_url(path('blog_post_show', {slug: post.slug})) }}">
{% endblock %}

{% block content %}
    <section class="bg-white">
        {% if post.featuredImage %}
            <div class="w-full max-w-4xl mx-auto">
                <img src="{{ asset('uploads/blog/' ~ post.featuredImage) }}" alt="Featured image" class="w-full object-cover rounded-xl shadow" style="aspect-ratio: 16 / 9; max-height: 600px;" loading="lazy">
            </div>
        {% endif %}

        <div class="max-w-5xl mx-auto px-6 text-center pt-10 pb-4">
            <h1 class="text-4xl md:text-6xl leading-tight tracking-tight text-gray-900 ">
                {{ post.title }}
            </h1>

            {% if post.excerpt %}
                <p class="mt-4 text-lg text-gray-600 italic">
                    {{ post.excerpt }}
                </p>
            {% endif %}

            <div class="mt-4 flex justify-center gap-6 text-sm text-gray-500 font-mono">
                <span>{{ post.createdAt|date('d.m.Y H:i') }}</span>
                <span>von {{ post.author.username }}</span>
                <span id="readTime" class="bg-gray-200 px-2 py-1 rounded text-xs uppercase tracking-wider"></span>
            </div>
        </div>
    </section>

    <section class="max-w-5xl mx-auto px-6 py-12 prose" id="postContent">
        {{ post.content|markdown_to_html }}
    </section>

    {% if post.tags is not empty %}
        <section class="max-w-3xl mx-auto px-6 pt-6 pb-4">
            <h2 class="text-lg font-bold mb-2 text-gray-700">Themen</h2>
            <ul class="flex flex-wrap gap-2">
                {% for tag in post.tags %}
                    <li>
                        <a href="{{ path('blog_post_by_tag', {slug: tag.slug}) }}" class="inline-block bg-gray-200 text-gray-800 text-xs px-3 py-1 rounded-full hover:bg-gray-300 transition">#{{ tag.name }}</a>
                    </li>
                {% endfor %}
            </ul>
        </section>
    {% endif %}

    {% if post.author.profile.biography %}
        <section class="max-w-3xl mx-auto px-6 py-12 mt-16 border-t border-gray-200">
            <h2 class="text-xl font-bold text-gray-900">{{ 'blog.post.about_author'|trans }}</h2>
            <div class="flex items-center space-x-4">
                <div>
                    <p class="text-lg font-semibold text-gray-900">{{ post.author.username }}</p>
                    <p class="text-gray-600">{{ post.author.profile.biography|markdown_to_html }}</p>
                </div>
            </div>
        </section>
    {% endif %}

    <script>
			document.addEventListener('DOMContentLoaded', () => {
				const text = document.getElementById('postContent').innerText;
				const words = text.trim().split(/\s+/).length;
				const readingTime = Math.max(1, Math.round(words / 200));
				document.getElementById('readTime').textContent = `${readingTime} min`;
			});
    </script>
{% endblock %}
